sap.ui.define(["./BaseController","sap/ui/model/Sorter","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/json/JSONModel","sap/m/MessageBox","../model/API"],function(t,e,o,n,a,r,i){"use strict";return t.extend("com.myorg.myUI5App.controller.SearchProducts",{onInit:function(){this.getRouter().getRoute("SearchProducts").attachPatternMatched(this._onRouteMatched,this)},_onRouteMatched:function(){const t=this.getModel("oData");const e=async()=>await i.getMatchCode(t)},factoryFilterBar:function(t,e){let a=null;switch(e.getProperty("control/type")){case"Input":a=new sap.m.Input({value:e.getProperty("control/value")}).setBindingContext(e,"filterContext");break;case"Select":a=new sap.m.Select({forceSelection:false,selectedKey:e.getProperty("control/value")}).bindItems({path:"/MatchCodeSet",filters:[new o("Atnam",n.EQ,"")],parameters:{$expand:"F4Set",$format:"json"},template:new sap.ui.core.Item({key:"{Atnam}",text:"{Atwtb}"}),templateShareable:false}).setBindingContext(e,"filterContext");break;default:break}return new sap.ui.comp.filterbar.FilterItem({name:e.getProperty("name"),label:this.getView().getModel("i18n").getResourceBundle().getText(e.getProperty("label")),visible:e.getProperty("visible"),control:a})},onFilterBarSearch:function(t){const e=this.getModel("oData");const o=t.getParameter("selectionSet");const n=[];const a=async()=>await i.getArticoloList(e,[]);o.forEach(t=>{const{oDataField:e,control:o}=t.getBindingContext("filterContext").getObject();n.push({oDataField:e,value:o.value})});a().then(t=>{this.getModel("searchProducts").setProperty("/table/items",t.results)}).catch(t=>{debugger})},onReset:function(){},onOpenDetailProduct:function(t){const e=t.getSource().getBindingContext("searchProducts");this.getRouter().navTo("ProductDetails",{ProductId:e.getProperty("Idprodotto")})},onOpenDialogProductAvailability:function(t){const e=t.getSource().getBindingContext("searchProducts").getObject();this._getDialogProductAvailable(e)},onSort:function(t){const o=t.getSource().getParent().getParent();const n=o.getBinding("items").aSorters[0].bDescending;o.getBinding("items").sort(new e("codice",!n))},_getDialogProductAvailable:function(t){if(!this._oDialogProdAvailab){this._oDialogProdAvailab=sap.ui.core.Fragment.load({id:this.getView().getId(),name:"com.myorg.myUI5App.view.fragment.SearchProducts.ProductAvailability",type:"XML",controller:this}).then(e=>{this.getView().addDependent(e);e.setModel(new a({context:t}),"productAvailability");return e})}this._oDialogProdAvailab.then(t=>{t.open()})},onCloseProd:function(t){t.getSource().getParent().close()}})});